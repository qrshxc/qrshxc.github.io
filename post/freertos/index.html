<!doctype html><html lang=zh-cn data-theme-mode=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>嵌入式实时系统的核心原理与 FreeRTOS 移植指南 | 黄小冲</title><meta name=description content="记录成长与学习的足迹"><script>window.siteConfig=JSON.parse('{"anchor_icon":null,"clipboard":{"copyright":{"content":"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！","count":50,"enable":false},"fail":"复制失败 (ﾟ⊿ﾟ)ﾂ","success":"复制成功(*^▽^*)"},"code_block":{"expand":true},"icon_font":"4552607_0khxww3tj3q9","outdate":{"daysago":180,"enable":false,"message":"本文最后更新于 {time}，请注意文中内容可能已经发生变化。"}}')</script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7cNoto%20Serif%20SC:400,400italic,700,700italic%7c&amp;display=swap" media=print onload='this.media="all"'><link rel=preload href=//at.alicdn.com/t/c/font_4552607_0khxww3tj3q9.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=stylesheet href=/css/loader.min.2ad0e9bbffb534e893c0ecefc44787a277cf851387e8ad9dccfbc3a5f0886dbe.css><meta property="og:type" content="website"><meta property="og:title" content="嵌入式实时系统的核心原理与 FreeRTOS 移植指南 | 黄小冲"><meta property="og:description" content="记录成长与学习的足迹"><meta property="og:url" content="https://qrshxc.github.io/post/freertos/"><meta property="og:site_name" content="九思的博客"><meta property="og:image" content="/"><meta property="article:author" content="黄小冲"><meta property="article:published_time" content="2025-08-08T17:41:58+08:00"><meta property="article:modified_time" content="2025-08-08T17:41:58+08:00"><meta name=twitter:card content="summary"><meta name=twitter:image content="/"><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/main.min.63684398a9584d95e2411a922ec8187281bbab44ffd348e26a806cae3370a598.css><link rel=preload as=style href=https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css onload='this.onload=null,this.rel="stylesheet"'><link rel=preload as=style href=https://npm.webcache.cn/katex@0.16.9/dist/katex.min.css onload='this.onload=null,this.rel="stylesheet"'><script src=https://npm.webcache.cn/pace-js@1.2.4/pace.min.js integrity=sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8 crossorigin=anonymous></script><link rel=stylesheet href=https://npm.webcache.cn/@reimujs/aos@0.1.0/dist/aos.css></head><body><div id=loader><div class="loading-left-bg loading-bg"></div><div class="loading-right-bg loading-bg"></div><div class=spinner-box><div class=loading-taichi><svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" shape-rendering="geometricPrecision"><path d="M303.5 432a80 80 0 01-12 160 80 80 0 0112-160z" fill="#ff5252"/><path d="M512 65a447 447 0 010 894V929a417 417 0 000-834 417 417 0 000 834v30a447 447 0 010-894zm0 30A417 417 0 01929 512 208.5 208.5.0 01720.5 720.5V592a80 80 0 000-160 80 80 0 000 160V720.5A208.5 208.5.0 01512 512 208.5 208.5.0 00303.5 303.5 208.5 208.5.0 0095 512 417 417 0 01512 95z" fill="#ff5252"/></svg></div><div class=loading-word>正在努力打败拖延兽...</div></div></div></div><script>var time=null,startLoading=()=>{time=Date.now(),document.getElementById("loader").classList.remove("loading")},endLoading=()=>{time?Date.now()-time>500?(time=null,document.body.style.overflow="auto",document.getElementById("loader").classList.add("loading")):(setTimeout(endLoading,500-(Date.now()-time)),time=null):(document.body.style.overflow="auto",document.getElementById("loader").classList.add("loading"))};window.addEventListener("DOMContentLoaded",endLoading),document.getElementById("loader").addEventListener("click",endLoading)</script><div id=copy-tooltip style="pointer-events:none;opacity:0;transition:all .2s ease;position:fixed;top:50%;left:50%;z-index:999;transform:translate(-50%,-50%);color:#fff;background:rgba(0,0,0,.5);padding:10px 15px;border-radius:10px"></div><div id=container><div id=wrap><div id=header-nav><nav id=main-nav><span class=main-nav-link-wrap><div class='main-nav-icon icon rotate'>&#xe62b;</div><a class=main-nav-link href=/>首页</a>
</span><span class=main-nav-link-wrap><div class='main-nav-icon icon rotate'>&#xe62b;</div><a class=main-nav-link href=/archives>归档</a>
</span><span class=main-nav-link-wrap><div class='main-nav-icon icon rotate'>&#xe62b;</div><a class=main-nav-link href=/about>关于</a>
</span><span class=main-nav-link-wrap><div class='main-nav-icon icon rotate'>&#xe62b;</div><a class=main-nav-link href=/friend>友链</a>
</span><a id=main-nav-toggle class=nav-icon></a></nav><nav id=sub-nav></nav></div><header id=header><picture></picture><img fetchpriority=high src=/images/banner.webp alt="嵌入式实时系统的核心原理与 FreeRTOS 移植指南"><div id=header-outer><div id=header-title><a href=/ id=logo><h1 data-aos=slide-up>嵌入式实时系统的核心原理与 FreeRTOS 移植指南</h1></a><h2 id=subtitle-wrap data-aos=slide-down></h2></div></div></header><div id=content class=sidebar-right><aside id=sidebar><div class="sidebar-wrapper wrap-sticky"><div class=sidebar-wrap data-aos=fade-up><div class=sidebar-toc-sidebar><div class=sidebar-toc><h3 class=toc-title>文章目录</h3><div class="sidebar-toc-wrapper toc-div-class"><nav id=TableOfContents><ul><li><a href=#1轮询式>1.轮询式</a></li><li></li><li><a href=#3多任务>3.多任务</a></li></ul><ul><li><a href=#1-ucos>1. uC/OS</a></li><li><a href=#2freertos>2.FreeRTOS</a></li><li><a href=#3rt-thread>3.RT-Thread</a></li></ul><ul><li><a href=#1任务的概念>1.任务的概念</a></li><li><a href=#2任务的状态>2.任务的状态</a></li><li><a href=#3任务优先级>3.任务优先级</a></li><li><a href=#4任务调度器>4.任务调度器</a></li><li><a href=#5任务的创建>5.任务的创建</a></li><li><a href=#6启动调度器>6.启动调度器</a></li><li><a href=#7任务的删除>7.任务的删除</a></li><li><a href=#8任务的挂起>8.任务的挂起</a></li><li><a href=#9任务的恢复>9.任务的恢复</a></li></ul></nav></div></div></div><div class="sidebar-common-sidebar hidden"><div class=sidebar-author><img data-src=/avatar/avatar.webp data-sizes=auto alt=黄小冲 class=lazyload><div class=sidebar-author-name>黄小冲</div><div class=sidebar-description>记录成长与学习的足迹</div></div><div class=sidebar-state><div class=sidebar-state-article><div>文章</div><div class=sidebar-state-number>32</div></div><div class=sidebar-state-category><div>分类</div><div class=sidebar-state-number>0</div></div><div class=sidebar-state-tag><div>标签</div><div class=sidebar-state-number>0</div></div></div><div class=sidebar-social><div class="icon-github sidebar-social-icon"><a href=https://github.com/qrshxc itemprop=url target=_blank aria-label=github rel="noopener external nofollow noreferrer"></a></div><div class="icon-google sidebar-social-icon"><a href=https://plus.google.com/crees itemprop=url target=_blank aria-label=google rel="noopener external nofollow noreferrer"></a></div></div><div class=sidebar-menu><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/ aria-label=首页></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>首页</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/archives aria-label=归档></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>归档</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/about aria-label=关于></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>关于</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/friend aria-label=友链></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>友链</div></div></div></div><div class=sidebar-btn-wrapper style=position:static><div class="sidebar-toc-btn current"></div><div class=sidebar-common-btn></div></div></div></div><div class=sidebar-widget></div></aside><section id=main><article class="h-entry article" itemprop=blogPost itemscope itemtype=https://schema.org/BlogPosting><div class=article-inner data-aos=fade-up><div class=article-meta><div class=article-date><span class=article-date-link data-aos=zoom-in><time datetime="2025-08-08 17:41:58 +0800 +0800" itemprop=datePublished>2025-08-08</time>
<time style=display:none id=post-update-time>2025-08-08</time></span></div><div class=article-category></div></div><div class=hr-line></div><div class="e-content article-entry" itemprop=articleBody><h1 id=一rtos的基本概念><a class=header-anchor href=#%e4%b8%80rtos%e7%9a%84%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5></a>一、RTOS的基本概念</h1><p>实时操作系统（Real Time Operating System）的简称就叫做RTOS，是指具有<strong>实时性</strong>、能支持实时控制系统工作的操作系统，RTOS的首要任务就是调度所有可以利用的资源来完成实时控制任务的工作，其次才是提高工作效率。</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124133609887.png alt=image-20251124133609887></p><p>RTOS就是一段嵌入在程序中的代码，在系统上电复位后首先被执行，可以理解为用户的主程序，只不过用户把产品的其他功能（子程序）都建立在RTOS之上，在RTOS中可以调用API函数为每个子程序都创建一个任务（也可以叫做线程），用户只需要调用RTOS内核中的相关的API函数接口就可以控制子程序，而且可以为每个任务设置不同的优先级，通过RTOS的调度器进行调度，这样就可以合理的使用CPU。</p><p>这里就涉及到产品的设计思路（裸机开发 or RTOS）以及程序的运行方式，可以分为三种：</p><h2 id=1轮询式><a class=header-anchor href=#1%e8%bd%ae%e8%af%a2%e5%bc%8f></a>1.轮询式</h2><p>轮询系统指的是程序运行时，先初始化各种硬件，初始化硬件之后程序进入一个死循环中，按照事件的顺序进行执行，该系统的结构非常简单，只适用于按照顺序执行事件并且没有外部事件来打断的情况，轮询系统就非常可靠，但是一旦有外部事件或者外部需要检测的信号来打断，则会造成外部事件的缺失。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span>  <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//硬件的初始化
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=c1>//事件1  LED  
</span></span></span><span class=line><span class=cl><span class=c1></span>       <span class=c1>//事件2  BEEP
</span></span></span><span class=line><span class=cl><span class=c1></span>       <span class=c1>//.......    KEY
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2><a class=header-anchor href=#></a></h2><p>前后台系统就是在轮询系统的基础上增加了<strong>中断</strong>，进行外部事件检测的时候就在中断中实现，所以中断也被称为前台，而其他事件还是在主程序的死循环中按照顺序执行，一旦中断发生，则会暂停执行后台的while(1),然后去执行前台的中断服务函数，如果事件简短，直接在中断中实现，如果事件复杂，则返回主程序的死循环实现，该方案可以提高程序的实时响应能力。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span>   <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=c1>//硬件的初始化
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=c1>//注册中断，设置中断的触发条件
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>    <span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>//事件1
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>//事件2
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>.....</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//中断服务函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span>  <span class=nf>XXX_IRQ</span> <span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//执行中断的事件
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//执行完成返回main函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h2 id=3多任务><a class=header-anchor href=#3%e5%a4%9a%e4%bb%bb%e5%8a%a1></a>3.多任务</h2><p>多任务系统指的是在前后台系统的基础上执行外部事件，只不过外部事件是放在任务中执行，不在中断服务函数中执行，一旦某个外部事件满足触发条件，就在中断服务函数中设置事件标志，然后在跳转到任务中执行事件，任务分优先级的，优先级高的任务就先执行，所以程序就会被分割为一个个的任务(不能退出)，每个任务都有一个独立的函数来执行的功能。更大程序提高程序的实时性。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span>  <span class=nf>task1</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>arg</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//LED
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span>  <span class=nf>task2</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>arg</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//BEEP
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span>  <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//硬件的初始化
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//注册中断，设置中断的触发条件
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//注册任务，根据任务调度器进行调度
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h1 id=二rtos的种类><a class=header-anchor href=#%e4%ba%8crtos%e7%9a%84%e7%a7%8d%e7%b1%bb></a>二.RTOS的种类</h1><p>RTOS是实时操作系统的统称，不意味着是某一种确定的操作系统，而是指某一类操作系统，比如最常用的uC/OSII、uC/OSIII、FreeRTOS、RTX、RT-Threa、Huawei LiteOS&mldr;&mldr;..每种RTOS各有特色，所以大家可以根据实际需要选择对应的RTOS进行学习。</p><h2 id=1-ucos><a class=header-anchor href=#1-ucos></a>1. uC/OS</h2><p>uC/OS是Micrium公司推出的RTOS实时操作系统，分为两个版本：uC/OSII 和 uC/OSIII，该RTOS的特点是<strong>开源的、可裁剪的、具有可剥夺型内核</strong>，uC/OSII可以支持创建最多255个任务，而uC/OSIII对任务数量没有限制。</p><p>uC/OS的发布时间是较早的，所以中文资料是最多的，并且代码例程比较丰富，但是想要在商业中进行使用，需要取得正版授权（花钱），所以大家可以把UCOS作为RTOS的入门。关于uC/OS的资料和源码都可以去官网下载 官网地址：<a href="http://www.baidu.com/link?url=wk280bWsMgbEkDbjGpgZ6qarAxWWKgHh1wsVjTu8EXJsiPAEV24tFK5iZ9cBE5mG">www.micrium.com</a></p><h2 id=2freertos><a class=header-anchor href=#2freertos></a>2.FreeRTOS</h2><p><strong>FreeRTOS</strong>也是RTOS的一种，在2003年发布，是免费的，虽然起步比UCOS晚，但是由于可以在<strong>商业中免费使用（MIT开源协议）</strong>，所以目前的<strong>市场占有率是最高的</strong>，并且很多的半导体公司都和FreeRTOS有很紧密的合作关系，这些半导体公司的评估板绝大多数都是采用FreeRTOS进行程序设计。比如半导体公司发布的SDK（开发工具包）一般也采用FreeRTOS，另外，像蓝牙、WIFI等带协议栈的芯片或者模块也是采用FreeRTOS。</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140138214.png alt=image-20251124140138214></p><p>相比于UCOS而言，FreeRTOS的文件<strong>数量更少，占用内存空间更少</strong>，所以在移植到不同硬件平台的时候更加轻松，FreeRTOS对于<strong>任务数量也是没有限制</strong>的，而是对于<strong>任务的优先级也没有限制</strong>。</p><p>FreeRTOS支持<strong>优先级抢占、时间片轮询</strong>等调度算法，而且FreeRTOS是完全免费的，这也是FreeRTOS的核心竞争力。</p><p>FreeRTOS可以用在商业领域，不具有版权问题，如果在产品中使用FreeRTOS时没有修改原码，则产品不需要开源，如果使用FreeRTOS的过程修改了原码，则需要把修改的那部分代码进行开源，遵循MIT开源协议。</p><p>大家可以去FreeRTOS的官网下载源码以及其他的资料，比如FreeRTOS提供了若干本书籍，比如关于RTOS的API函数的参考手册以及新手教程。 官网地址：<a href=http://www.freertos.org>www.freertos.org</a></p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140156735.png alt=image-20251124140156735></p><h2 id=3rt-thread><a class=header-anchor href=#3rt-thread></a>3.RT-Thread</h2><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140215969.png alt=image-20251124140215969></p><h1 id=三rtos的源码下载><a class=header-anchor href=#%e4%b8%89rtos%e7%9a%84%e6%ba%90%e7%a0%81%e4%b8%8b%e8%bd%bd></a>三、RTOS的源码下载</h1><p>(1) 点击选项链接跳转GitHub托管网站，下载FreeRTOS以前的发行源码包， 比如<strong>V9.0.0</strong></p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140229637.png alt=image-20251124140229637></p><p>(1) 点击GitHub的标签tags，显示所有的FreeRTOS的源码发行版，搜索到****V9.0.0****版本即可</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140237815.png alt=image-20251124140237815></p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140246757.png alt=image-20251124140246757></p><p>注意：如果浏览器在登录GitHub网站时等待时间过长，或者无法登录界面，则可以使用其他的代码托管网站进行源码下载，比如***Sourceforge代码托管网站*** ，搜索FreeRTOS即可。</p><h1 id=四rtos源码结构><a class=header-anchor href=#%e5%9b%9brtos%e6%ba%90%e7%a0%81%e7%bb%93%e6%9e%84></a>四.RTOS源码结构</h1><p>解压好的源码包内部有一个叫做FreeRTOS的文件夹，该文件夹内部包含FreeRTOS的源码以及许可和通用的头文件，并且还提供丰富的案例供用户在不同的硬件平台使用。</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124135702455.png alt=image-20251124135702455></p><p>Demo中提供了很多个半导体公司的评估板的代码例程，用户可以参考甚至直接使用。而License文件夹中包含了FreeRTOS的许可文件，大家可以在商业软件中进行参考，在Source文件夹中包含通用的头文件以及针对不同硬件平台的移植文件供用户使用。</p><h1 id=五freertos的移植><a class=header-anchor href=#%e4%ba%94freertos%e7%9a%84%e7%a7%bb%e6%a4%8d></a>五、FreeRTOS的移植</h1><p>如果想要在项目中利用RTOS对任务进行调度，则需要把RTOS的源码移植到自己的项目中，移植的步骤如下：</p><p>(1) 去FreeRTOS的官网下载源码包，源码包的版本可以是V9.0.0或更新的版本 （比较稳定）</p><p>(1) 把源码包解压到本地，分析源码包中哪些文件需要移植，可以浏览源码包的readme.txt</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124135611088.png alt=image-20251124135611088></p><p>(3) 把FreeRTOS 源码包中需要移植的文件拷贝到自己工程中对应的文件夹：
(4) 打开自己的工程，把拷贝过来文件添加到KEIL5 工程中，编辑文件夹的结构，如下所示</p><p>(5) 配置KEIL5 工程的头文件的路径，确保编译器可以找到关于FreeRTOS 的头文件，如下：</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124135827920.png alt=image-20251124135827920></p><p>(6) 编译工程，如果编译之后报错，根据错误原因解决错误，直到编译通过为止，如下所示</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124135928619.png alt=image-20251124135928619></p><p>提示：__ICCARM__宏定义是和开发工具相关的，该宏定义是IAR 软件需要使用的，而目前采用的开发工具是KEIL，KEIL 软件需要使用其他的宏定义。
再次编译，发现有函数出现重复定义的情况，port.c 和stm32f4xx_it.c 中出现，所以可以选择分别进行分析，可以把stm32f4xx_it.c 中的函数名称删除即可。</p><p>再次编译，发现有5 个函数未定义，命名规则是有规律的，都是HooK 结尾，Hook 是钩子函数，其实属于回调函数的一种，目前由于不知道是否需要使用，可以选择不去定制。</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140012369.png alt=image-20251124140012369></p><p>由于FreeRTOS 是高度可定制的，定制的功能是由FreeRTOSConfig.h 决定，所以需要配置该头文件，裁剪掉这几个功能即可。</p><p>再次编译，发现没有出现任何错误和任何警告，则说明FreeRTOS 实时操作系统移植成功！！</p><h1 id=六freertos-的任务管理><a class=header-anchor href=#%e5%85%adfreertos-%e7%9a%84%e4%bb%bb%e5%8a%a1%e7%ae%a1%e7%90%86></a>六、FreeRTOS 的任务管理</h1><h2 id=1任务的概念><a class=header-anchor href=#1%e4%bb%bb%e5%8a%a1%e7%9a%84%e6%a6%82%e5%bf%b5></a>1.任务的概念</h2><p>FreeRTOS 是一个支持多任务的实时操作系统，如之前裸机开发时采用的轮询系统而言，主程序是一个死循环，CPU 按照死循环中的流程执行代码，而在多任务系统中，用户可以把整个系统分割为多个独立的且不能返回（死循环）的函数，这些函数就被称为任务。
应用程序中的任务都是由FreeRTOS 的调度器进行调度，同时每个任务具有独立的栈空间，栈空间其实就是单片机中RAM 的一段空间，通常可以提前定义一个全局数组，或者在创建任务的时候对任务的栈空间进行动态的分配，可以参考FreeRTOS 的官方资料。</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140356804.png alt=image-20251124140356804></p><h2 id=2任务的状态><a class=header-anchor href=#2%e4%bb%bb%e5%8a%a1%e7%9a%84%e7%8a%b6%e6%80%81></a>2.任务的状态</h2><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140423324.png alt=image-20251124140423324></p><h2 id=3任务优先级><a class=header-anchor href=#3%e4%bb%bb%e5%8a%a1%e4%bc%98%e5%85%88%e7%ba%a7></a>3.任务优先级</h2><p>FreeRTOS 可以为每一个创建的任务分配一个优先级，当然也可以让多个任务共用一个优先级，这里就涉及到调度器的调度算法，有抢占式、时间片一共2 种算法。</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140535296.png alt=image-20251124140535296></p><h2 id=4任务调度器><a class=header-anchor href=#4%e4%bb%bb%e5%8a%a1%e8%b0%83%e5%ba%a6%e5%99%a8></a>4.任务调度器</h2><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140554133.png alt=image-20251124140554133></p><h2 id=5任务的创建><a class=header-anchor href=#5%e4%bb%bb%e5%8a%a1%e7%9a%84%e5%88%9b%e5%bb%ba></a>5.任务的创建</h2><p>刚才提到过任务都是独立的，并且每个任务都需要占用一部分RAM 空间，单片机中的RAM是有限的，所以FreeRTOS 就提供了两种方案为每个任务分配栈空间：静态分配+ 动态分配，而且FreeRTOS 提供了不同的函数接口给用户去申请任务的空间。两种分配方案的区别如下：
一般情况下采用动态分配的方案，所以需要调用API 函数，名字叫做xTaskCreate()，如下图</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140624059.png alt=image-20251124140624059></p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140631477.png alt=image-20251124140631477></p><h2 id=6启动调度器><a class=header-anchor href=#6%e5%90%af%e5%8a%a8%e8%b0%83%e5%ba%a6%e5%99%a8></a>6.启动调度器</h2><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140725228.png alt=image-20251124140725228></p><h2 id=7任务的删除><a class=header-anchor href=#7%e4%bb%bb%e5%8a%a1%e7%9a%84%e5%88%a0%e9%99%a4></a>7.任务的删除</h2><p>FreeRTOS 中的任务是可以删除的，如果用户创建的任务只打算运行一次就可以删掉，调用函数接口vTaskDelete() ，调用该函数就可以把动态创建或者静态创建的任务从任务表中删掉。</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140749536.png alt=image-20251124140749536></p><h2 id=8任务的挂起><a class=header-anchor href=#8%e4%bb%bb%e5%8a%a1%e7%9a%84%e6%8c%82%e8%b5%b7></a>8.任务的挂起</h2><p>在某些情况下，某些任务可能只运行一段时间，然后让任务暂停运行，过一段时间继续运行，如果采用反复删除和反复创建的方案，就会导致任务之前的数据丢失，FreeRTOS 提供一个函数可以把任务挂起，该函数为vTaskSuspend() 。</p><p><img src=https://raw.githubusercontent.com/qrshxc/img/main/image-20251124140845499.png alt=image-20251124140845499></p><p>一旦任务被挂起，则不管任务的优先级是否为最高，都不会获得CPU 资源，也就是说处于挂起态的任务永远不能进入运行态，除非该任务被恢复，如果想要恢复一个任务，则需要调用vTaskResume()。</p><h2 id=9任务的恢复><a class=header-anchor href=#9%e4%bb%bb%e5%8a%a1%e7%9a%84%e6%81%a2%e5%a4%8d></a>9.任务的恢复</h2><p>FreeRTOS 提供了一个恢复函数，可以让处于挂起态的任务恢复，注意只有被挂起的任务才可以被恢复。</p></div><footer class=article-footer><ul class=article-tag-list itemprop=keywords></ul></footer></div><nav id=article-nav data-aos=fade-up><div class="article-nav-link-wrap article-nav-link-left"><img data-src=https://d-sketon.top/img/_backwebp/bg1.webp data-sizes=auto alt="RFID 多标签防碰撞机制深度解析：读写器如何从多张卡片中准确选中一张？" class=lazyload>
<a href=https://qrshxc.github.io/post/acm/></a><div class=article-nav-caption>前一篇</div><h3 class=article-nav-title>RFID 多标签防碰撞机制深度解析：读写器如何从多张卡片中准确选中一张？</h3></div></nav></article></section></div><footer id=footer><div style=width:100%;overflow:hidden><div class=footer-line></div></div><div id=footer-info><div><span class=icon-copyright></span>
2020 -
2025
<span class="footer-info-sep rotate"></span>
黄小冲</div><div>基于&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a>&nbsp; Theme.<a href=https://github.com/D-Sketon/hugo-theme-reimu target=_blank>Reimu</a></div><div><span class=icon-brush>&nbsp;
74.1k
</span>&nbsp;|&nbsp;
<span class=icon-coffee>&nbsp;
02:45</span></div><div class=footer-beian><a target=_blank rel=noopener href=https://beian.miit.gov.cn>赣ICP备2025054780号-1</a></div><div><span class=icon-eye></span>
<span id=busuanzi_container_site_pv>总访问量&nbsp;<span id=busuanzi_value_site_pv></span></span>
&nbsp;|&nbsp;
<span class=icon-user></span>
<span id=busuanzi_container_site_uv>总访客量&nbsp;<span id=busuanzi_value_site_uv></span></span></div></div></footer><div class=sidebar-top><div class="sidebar-top-taichi rotate"></div><div class=arrow-up></div></div><div id=mask class=hide></div></div><nav id=mobile-nav><div class=sidebar-wrap><div class=sidebar-toc-sidebar><div class=sidebar-toc><h3 class=toc-title>文章目录</h3><div class="sidebar-toc-wrapper toc-div-class"><nav id=TableOfContents><ul><li><a href=#1轮询式>1.轮询式</a></li><li></li><li><a href=#3多任务>3.多任务</a></li></ul><ul><li><a href=#1-ucos>1. uC/OS</a></li><li><a href=#2freertos>2.FreeRTOS</a></li><li><a href=#3rt-thread>3.RT-Thread</a></li></ul><ul><li><a href=#1任务的概念>1.任务的概念</a></li><li><a href=#2任务的状态>2.任务的状态</a></li><li><a href=#3任务优先级>3.任务优先级</a></li><li><a href=#4任务调度器>4.任务调度器</a></li><li><a href=#5任务的创建>5.任务的创建</a></li><li><a href=#6启动调度器>6.启动调度器</a></li><li><a href=#7任务的删除>7.任务的删除</a></li><li><a href=#8任务的挂起>8.任务的挂起</a></li><li><a href=#9任务的恢复>9.任务的恢复</a></li></ul></nav></div></div></div><div class="sidebar-common-sidebar hidden"><div class=sidebar-author><img data-src=/avatar/avatar.webp data-sizes=auto alt=黄小冲 class=lazyload><div class=sidebar-author-name>黄小冲</div><div class=sidebar-description>记录成长与学习的足迹</div></div><div class=sidebar-state><div class=sidebar-state-article><div>文章</div><div class=sidebar-state-number>32</div></div><div class=sidebar-state-category><div>分类</div><div class=sidebar-state-number>0</div></div><div class=sidebar-state-tag><div>标签</div><div class=sidebar-state-number>0</div></div></div><div class=sidebar-social><div class="icon-github sidebar-social-icon"><a href=https://github.com/qrshxc itemprop=url target=_blank aria-label=github rel="noopener external nofollow noreferrer"></a></div><div class="icon-google sidebar-social-icon"><a href=https://plus.google.com/crees itemprop=url target=_blank aria-label=google rel="noopener external nofollow noreferrer"></a></div></div><div class=sidebar-menu><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/ aria-label=首页></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>首页</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/archives aria-label=归档></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>归档</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/about aria-label=关于></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>关于</div></div><div class=sidebar-menu-link-wrap><a class=sidebar-menu-link-dummy href=/friend aria-label=友链></a><div class='sidebar-menu-icon icon rotate'>&#xe62b;</div><div class=sidebar-menu-link>友链</div></div></div></div></div><div class=sidebar-btn-wrapper><div class="sidebar-toc-btn current"></div><div class=sidebar-common-btn></div></div></nav></div><script src=https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js integrity=sha384-3gT/vsepWkfz/ff7PpWNUeMzeWoH3cDhm/A8jM7ouoAK0/fP/9bcHHR5kHq2nf+e crossorigin=anonymous></script><script src=https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js integrity=sha384-J08i8An/QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q crossorigin=anonymous></script><script src=/js/main.js integrity crossorigin=anonymous></script><script src=/js/aos.js integrity crossorigin=anonymous></script><script>var aosInit=()=>{AOS.init({duration:1e3,easing:"ease",once:!0,offset:50})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",aosInit):aosInit()</script><script src=/js/pjax_main.js integrity crossorigin=anonymous data-pjax></script><script src=https://npm.webcache.cn/mouse-firework@0.1.0/dist/index.umd.js integrity=sha384-KM6i7tu43nYd6e0beIljxHMC5tZc58XBDu7pPA58w50h18Jsx7gLdimfS09RXlKv crossorigin=anonymous></script><script>if(window.firework){const e=JSON.parse('{"excludeelements":["a","button"],"particles":[{"colors":["#ff5252","#ff7c7c","#ffafaf","#ffd0d0"],"duration":[1200,1800],"easing":"easeOutExpo","move":["emit"],"number":20,"shape":"circle","shapeOptions":{"alpha":[0.3,0.5],"radius":[16,32]}},{"colors":["#ff0000"],"duration":[1200,1800],"easing":"easeOutExpo","move":["diffuse"],"number":1,"shape":"circle","shapeOptions":{"alpha":[0.2,0.5],"lineWidth":6,"radius":20}}]}');e.excludeElements=e.excludeelements,delete e.excludeelements,window.firework(e)}</script><div id=lazy-script><div><script data-pjax>window.REIMU_POST={author:"黄小冲",title:"嵌入式实时系统的核心原理与 FreeRTOS 移植指南",url:"https://qrshxc.github.io/post/freertos/",description:` 一、RTOS的基本概念 实时操作系统（Real Time Operating System）的简称就叫做RTOS，是指具有实时性、能支持实时控制系统工作的操作系统，RTOS的首要任务就是调度所有可以利用的资源来完成实时控制任务的工作，其次才是提高工作效率。
`,cover:"https://qrshxc.github.io/images/banner.webp"}</script><script src=/js/insert_highlight.js integrity crossorigin=anonymous data-pjax></script><script type=module data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js", "sha384-DiL6M\/gG\u002bwmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF\/N6lrZi\/")).default;

        const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https:\/\/npm.webcache.cn\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8\u002boTJ7m3DfYEWX1fu1scuS4\u002bs")
            }).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script></div></div><script src=https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js async integrity=sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S crossorigin=anonymous></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(e=>{for(let t of e)t.unregister()})</script><script>const reimuCopyright=String.raw`
   ______     ______     __     __    __     __  __    
  /\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
  \ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
   \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
    \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                    
  `;console.log(String.raw`%c ${reimuCopyright}`,"color: #ff5252;"),console.log("%c Theme.Reimu %c https://github.com/D-Sketon/hugo-theme-reimu ","color: white; background: #ff5252; padding:5px 0;","padding:4px;border:1px solid #ff5252;")</script></body></html>